plugins {
    id 'java'
    id 'distribution'
}

//noinspection GroovyUnusedAssignment
sourceCompatibility = 1.8
//noinspection GroovyUnusedAssignment
targetCompatibility = 1.8

repositories {
    jcenter()
}

dependencies {
    compile group: 'com.google.guava', name: 'guava', version: '18.0'
    compile 'org.mod4j.org.apache.commons:cli:1.0.0'
    compile 'org.apache.commons:commons-lang3:3.4'
    compile 'org.apache.commons:commons-math3:3.5'
    testCompile 'org.testng:testng:6.9.4'
}

sourceSets {
    main {
        java {
            srcDir 'src/java'
        }
    }
    test {
        java {
            srcDir 'test/java'
        }
        resources {
            srcDir 'test/resources'
        }
    }
}

test.doFirst {
    useTestNG()
}

wrapper.gradleVersion = '2.4'

@SuppressWarnings("GroovyAssignabilityCheck")
CreateStartScripts buildStartScript(String appName, String mainClass) {
    task "${appName}StartScript"(type: CreateStartScripts) {
        mainClassName = mainClass
        applicationName = appName
        outputDir = new File(project.buildDir, 'scripts');
        classpath = jar.outputs.files + project.configurations.runtime
        group = "scripts"
    }
}

task addAllStartSctipts {
    group = "scripts"
    buildStartScript("cpmr", "edu.cwru.cbc.ASM.CPMR.CPMR_Pgm").execute()
    buildStartScript("detect", "edu.cwru.cbc.ASM.detect.DetectionPgm").execute()
    buildStartScript("convert", "edu.cwru.cbc.ASM.tools.conversion.FormatConversionPgm").execute()
    buildStartScript("intersect", "edu.cwru.cbc.ASM.tools.intersect.IntersectRegionsPgm").execute()
    buildStartScript("simulate", "edu.cwru.cbc.ASM.tools.simulation.SimulationPgm").execute()
    buildStartScript("visualize", "edu.cwru.cbc.ASM.tools.visualization.ReadsVisualizationPgm").execute()
}

distributions {
    //noinspection GroovyAssignabilityCheck
    main {
        contents {
            addAllStartSctipts
            into('bin') {
                from 'build/scripts'
            }
            into('lib') {
                from 'build/libs'
                from configurations.runtime
            }

            exclude "**/*.bat"
        }
    }
}
